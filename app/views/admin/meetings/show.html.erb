<div class="flex items-center justify-between mb-6">
  <div class="flex items-center gap-3">
    <h1 class="text-2xl font-bold text-gray-900"><%= @meeting.display_name %></h1>
    <% if @meeting.minutes_imported? %>
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Minutes imported</span>
    <% end %>
  </div>
  <div class="flex items-center gap-3">
    <%= link_to "Back", admin_meetings_path, class: "text-sm text-gray-600 hover:text-gray-800" %>
    <%= form_with url: import_minutes_admin_meeting_path(@meeting), method: :post, multipart: true, class: "flex items-center gap-2" do %>
      <input type="file" name="minutes_file" accept=".json" class="text-sm text-gray-500 file:mr-2 file:py-1.5 file:px-3 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 file:cursor-pointer" />
      <button type="submit" class="inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors cursor-pointer">Import Minutes</button>
    <% end %>
    <% if @meeting.minutes_imported? %>
      <%= button_to "Delete Minutes", delete_minutes_admin_meeting_path(@meeting), method: :delete, class: "inline-flex items-center px-3 py-1.5 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors cursor-pointer", data: { turbo_confirm: "Are you sure you want to delete minutes data? This will remove all vote records for this meeting." } %>
    <% end %>
    <%= button_to "Delete Meeting", admin_meeting_path(@meeting), method: :delete, class: "inline-flex items-center px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors cursor-pointer", data: { turbo_confirm: "Are you sure you want to delete this meeting?" } %>
  </div>
</div>

<% if @meeting.agenda_versions.size > 1 %>
  <div class="mb-6">
    <%= form_with url: admin_meeting_path(@meeting), method: :get, local: true, class: "flex items-center gap-3" do %>
      <label for="version" class="text-sm font-medium text-gray-700">Agenda version:</label>
      <select name="version" id="version" onchange="this.form.requestSubmit()" class="block rounded-md border-gray-300 shadow-sm text-sm focus:border-blue-500 focus:ring-blue-500">
        <% @meeting.agenda_versions.each do |v| %>
          <option value="<%= v.version_number %>" <%= "selected" if v == @agenda_version %>><%= v.display_label %></option>
        <% end %>
      </select>
    <% end %>
  </div>
<% end %>

<div class="grid grid-cols-3 gap-4 mb-8">
  <div class="bg-white rounded-lg border border-gray-200 p-4">
    <p class="text-2xl font-bold text-gray-900"><%= @agenda_version&.agenda_pages || "N/A" %></p>
    <p class="text-sm text-gray-500">Agenda pages</p>
  </div>
  <div class="bg-white rounded-lg border border-gray-200 p-4">
    <p class="text-2xl font-bold text-gray-900"><%= @agenda_sections.size %></p>
    <p class="text-sm text-gray-500">Sections</p>
  </div>
  <div class="bg-white rounded-lg border border-gray-200 p-4">
    <p class="text-2xl font-bold text-gray-900"><%= @agenda_sections.sum { |s| s.agenda_items.size } %></p>
    <p class="text-sm text-gray-500">Agenda items</p>
  </div>
</div>

<div class="space-y-6">
  <% @agenda_sections.each do |section| %>
    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <h2 class="font-semibold text-gray-900"><%= section.number %>. <%= section.title %></h2>
        <span class="text-xs text-gray-500"><%= section.section_type.titleize %> &middot; <%= section.agenda_items.size %> items</span>
      </div>

      <% if section.agenda_items.any? %>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">File #</th>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pages</th>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">PDF</th>
              <th class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase">Result</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% section.agenda_items.each do |item| %>
              <tr>
                <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-600"><%= item.item_number %></td>
                <td class="px-6 py-3 text-sm text-gray-900"><%= item.title %></td>
                <td class="px-6 py-3 whitespace-nowrap text-sm">
                  <% if item.file_number.present? %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"><%= item.file_number %></span>
                  <% end %>
                </td>
                <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">
                  <% if item.page_start.present? %>
                    pp. <%= item.page_start %>-<%= item.page_end %>
                  <% end %>
                </td>
                <td class="px-6 py-3 whitespace-nowrap text-sm">
                  <% if item.url.present? %>
                    <%= link_to "View PDF", item.url, target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800" %>
                  <% end %>
                </td>
                <td class="px-6 py-3 whitespace-nowrap text-sm">
                  <% if item.result.present? %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"><%= item.result.titleize %></span>
                    <% if item.vote_tally.present? %>
                      <span class="text-gray-500 ml-1">(<%= item.vote_tally %>)</span>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>
  <% end %>
</div>
